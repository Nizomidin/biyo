name: Backend CI/CD

on:
  push:
    branches: [main]
    paths:
      - 'backend/**'
      - '.github/workflows/backend.yml'
  pull_request:
    branches: [main]
    paths:
      - 'backend/**'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        working-directory: ./backend
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run tests (if available)
        working-directory: ./backend
        run: |
          # Add your test command here when tests are added
          # pytest tests/ || true
          echo "No tests configured yet"

      - name: Check backend syntax
        working-directory: ./backend
        run: |
          python -m py_compile main.py models.py schemas.py database.py || true

  # Deploy to Railway (uncomment and configure)
  # deploy-railway:
  #   needs: test
  #   runs-on: ubuntu-latest
  #   if: github.ref == 'refs/heads/main'
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4
  #
  #     - name: Deploy to Railway
  #       uses: bervProject/railway-deploy@v0.3.0
  #       with:
  #         railway_token: ${{ secrets.RAILWAY_TOKEN }}
  #         service: backend
  #         detach: true

  # Deploy to Render (alternative - uncomment and configure)
  # deploy-render:
  #   needs: test
  #   runs-on: ubuntu-latest
  #   if: github.ref == 'refs/heads/main'
  #   steps:
  #     - name: Trigger Render deployment
  #       run: |
  #         curl -X POST "${{ secrets.RENDER_DEPLOY_HOOK_URL }}" || true

